<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simplified Vertex-Wise Analyses of Whole-Brain and Hippocampal Surface • VertexWiseR</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Simplified Vertex-Wise Analyses of Whole-Brain and Hippocampal Surface">
<meta name="description" content="Provides functions to run statistical analyses on surface-based neuroimaging data, computing measures including cortical thickness and surface area of the whole-brain and of the hippocampi. It can make use of FreeSurfer, fMRIprep, HCP and CAT12 preprocessed datasets and HippUnfold hippocampal segmentation outputs for a given sample by restructuring the data values into a single file. The single file can then be used by the package for analyses independently from its base dataset and without need for its access.">
<meta property="og:description" content="Provides functions to run statistical analyses on surface-based neuroimaging data, computing measures including cortical thickness and surface area of the whole-brain and of the hippocampi. It can make use of FreeSurfer, fMRIprep, HCP and CAT12 preprocessed datasets and HippUnfold hippocampal segmentation outputs for a given sample by restructuring the data values into a single file. The single file can then be used by the package for analyses independently from its base dataset and without need for its access.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">VertexWiseR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Python_troubleshooting.html">Python troubleshooting</a></li>
    <li><a class="dropdown-item" href="articles/VertexWiseR_Example_1.html">Example analyses with VertexWiseR - Example 1</a></li>
    <li><a class="dropdown-item" href="articles/VertexWiseR_Example_2.html">Example analyses with VertexWiseR - Example 2</a></li>
    <li><a class="dropdown-item" href="articles/VertexWiseR_surface_extraction.html">Extracting surface data in VertexWiseR</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Updates</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="vertexwiser-a-package-for-simplified-vertex-wise-analyses-of-whole-brain-and-hippocampal-surface-in-r">VertexWiseR: a package for simplified vertex-wise analyses of whole-brain and hippocampal surface in R<a class="anchor" aria-label="anchor" href="#vertexwiser-a-package-for-simplified-vertex-wise-analyses-of-whole-brain-and-hippocampal-surface-in-r"></a>
</h2>
<!---start of badges-->
<p><a href="https://CRAN.R-project.org/package=VertexWiseR" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/VertexWiseR"></a> <a href="https://cran.r-project.org/package=VertexWiseR" class="external-link"><img src="https://www.r-pkg.org/badges/version/VertexWiseR" alt="CRAN status"></a> <!---end of badges--></p>
<p><img src="reference/figures/Flowchart.jpg" alt="VertexWise workflow summary"><!-- --></p>
<div class="section level3">
<h3 id="setting-up-for-the-first-time">Setting up for the first time<a class="anchor" aria-label="anchor" href="#setting-up-for-the-first-time"></a>
</h3>
<p>VertexWiseR can be installed and loaded using the following code in R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'VertexWiseR'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cogbrainhealthlab.github.io/VertexWiseR/">VertexWiseR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Alternatively</span></span>
<span><span class="co">#install.packages("devtools")</span></span>
<span><span class="co">#devtools::install_github("CogBrainHealthLab/VertexWiseR")</span></span></code></pre></div>
<p>VertexWiseR imports and makes use of the R package <a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a>. <code>reticulate</code> is a package that allows R to borrow or translate python functions into R. Using reticulate, the package calls functions from the <a href="https://brainstat.readthedocs.io/en/latest/" class="external-link">BrainStat</a> Python module. Brainstat also comes with a number of fsaverage templates that need to be downloaded for use with VertexWiseR cortical analyses.</p>
<p>For ‘reticulate’ to work properly with VertexWiseR, a Python environment must be installed with it — the default choice offered by VertexWiseR is to let reticulate (version 1.41.0) create an ephemeral Python virtual environment using <a href="https://posit.co/blog/reticulate-1-41/" class="external-link">UV and py_require()</a>. Alternatively, <code>Miniconda</code> — a lightweight version of Python -, or a suitable version of Python can be installed.</p>
<p>A function can be run to download and install all the system requirements (Python environment, BrainStat, BrainStat’s fsaverage/parcellation templates) if they are not installed yet:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/VWRfirstrun.html">VWRfirstrun</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Note: A pop-up/prompt from reticulate asking ‘Would you like to create a default Python environment for the reticulate package?’ may appear. Clicking Yes will let reticulate install Python in a virtual environment. This is entirely optional. Simply click No/Cancel to ignore.</p>
<p>Alternatively, advanced users may specify a pre-installed python environment using reticulate’s <a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_python() or use_virtualenv() functions</a>.</p>
<div class="section level4">
<h4 id="loading-datasets">Loading datasets<a class="anchor" aria-label="anchor" href="#loading-datasets"></a>
</h4>
<p>For this example, we use Spreng and colleagues’ neurocognitive aging <a href="https://openneuro.org/datasets/ds003592/versions/1.0.13" class="external-link">openneuro dataset ds003592</a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demodata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'demo_data/SPRENG_behdata_site1.rds'</span>, package <span class="op">=</span> <span class="st">'VertexWiseR'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The dataset T1 weighted images were preprocessed using the recon-all <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/FreeSurferWiki" class="external-link">FreeSurfer</a> pipeline. This tutorial will not reiterate these steps. For a detailed guide about surface extraction (from FreeSurfer, fMRIprep, HPC and HippUnfold outputs), see the <a href="https://cogbrainhealthlab.github.io/VertexWiseR/articles/VertexWiseR_surface_extraction.html">Extracting surface data in VertexWiseR</a> article.</p>
<p>Here, we explain how, from a given FreeSurfer subject directory, VertexWiseR extracts surface-based measures and synthesizes the whole-sample data into a compact matrix object (.rds) for later analyses.</p>
<p>SURFvextract() gives the opportunity to extract surface-based measures including ‘thickness’, ‘curv’, ‘sulc’, and ‘area’. Here, we were interested in cortical thickness (CT), so the command which we entered to extract CT from the Spreng dataset was as follows (the sdirpath is just an example):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/SURFvextract.html">SURFvextract</a></span><span class="op">(</span>sdirpath <span class="op">=</span> <span class="st">"spreng_freesurfer_subjectsdir/"</span>, filename <span class="op">=</span> <span class="st">"SPRENG_CTv.rds"</span>, measure <span class="op">=</span> <span class="st">"thickness"</span><span class="op">)</span> </span></code></pre></div>
<p>A cortical thickness matrix object extracted from the Spreng dataset is included in the VertexWiseR git repository and can be loaded with the following code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SPRENG_CTv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://github.com/CogBrainHealthLab/VertexWiseR/blob/main/inst/demo_data/SPRENG_CTv_site1.rds?raw=TRUE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="smoothing-the-surface-data">Smoothing the surface data<a class="anchor" aria-label="anchor" href="#smoothing-the-surface-data"></a>
</h4>
<p>VertexWiseR gives the option to smooth the surface data with a desired full width at half maximum (FWHM) value. It can also optionally directly be done as an option for RFT_vertex_analysis() which will be discussed below. Here, we smooth it before the analysis at 10 mm:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SPRENG_CTv</span> <span class="op">=</span> <span class="fu"><a href="reference/smooth_surf.html">smooth_surf</a></span><span class="op">(</span><span class="va">SPRENG_CTv</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="preparing-the-model">Preparing the model<a class="anchor" aria-label="anchor" href="#preparing-the-model"></a>
</h4>
<p>The vertex-wise analysis model works as a multiple regression model where the Dependent Variable/outcome is the CT at each vertex, and you will decide which Independent Variables/predictors to enter into the model to predict the vertices’ CT. In this example, we shall use <code>age</code> and <code>sex</code> to predict CT. Among these IVs, we are mostly interested in age, sex being entered into the model to control for its confounding influence on CT. We thus select those two variables and save them into a new data.frame called <code>all_pred</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_pred</span><span class="op">=</span><span class="va">demodata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>,<span class="st">"age"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_pred</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">##   sex age</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## 1 F   21</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="do">## 2 F   73</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## 3 F   77</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="do">## 4 M   68</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="do">## 5 F   60</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="do">## 6 F   71</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="the-actual-analysis">The actual analysis<a class="anchor" aria-label="anchor" href="#the-actual-analysis"></a>
</h4>
<p>The next code chunk runs the analysis. There is an optional <code>p</code> parameter for the <code><a href="reference/RFT_vertex_analysis.html">RFT_vertex_analysis()</a></code> function to specify the p threshold; default p is set to 0.05. The atlas with which to label the significant clusters can also be set (1=aparc/Desikan-Killiany-70 (default), 2=Schaefer-100, 3=Schaefer-200, 4=Glasser-360, 5=Destrieux-148).</p>
<p>The second line displays the results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">=</span><span class="fu"><a href="reference/RFT_vertex_analysis.html">RFT_vertex_analysis</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">all_pred</span>, contrast <span class="op">=</span><span class="va">all_pred</span><span class="op">$</span><span class="va">age</span>, surf_data <span class="op">=</span> <span class="va">SPRENG_CTv</span>, atlas <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">cluster_level_results</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## $`Positive contrast`</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="do">## clusid nverts     P     X    Y   Z tstat          region</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">## 1      1    142 0.015 -22.8 11.5 -42  6.45 lh-temporalpole</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">## $`Negative contrast`</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="do">##   clusid nverts      P   X     Y     Z  tstat              region</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="do">## 1      1   8039 &lt;0.001  47   4.0 -16.6 -12.64 rh-superiortemporal</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="do">## 2      2   7660 &lt;0.001 -34 -25.7  16.2 -14.23           lh-insula</span></span></code></pre></div>
<p>In the above results, the clusters that appear under the <code>Positive contrast</code> section are clusters of vertices which correlate positively with your <code>contrast</code> variable, vice-versa for the <code>Negative contrast</code>.</p>
<ul>
<li><p><code>nverts</code>: number of vertices in the cluster</p></li>
<li><p><code>P</code>: p-value of the cluster</p></li>
<li><p><code>X, Y and Z</code>: MNI coordinates of the vertex with the highest t-stat in the cluster</p></li>
<li><p><code>tstat</code>: t statistic of the vertex with the highest t-stat in the cluster</p></li>
<li><p><code>region</code>: the region this highest t-stat vertex is located in. Here, it is determined/labelled using the <a href="https://surfer.nmr.mgh.harvard.edu/ftp/articles/desikan06-parcellation.pdf" class="external-link">Desikan atlas</a></p></li>
</ul>
</div>
<div class="section level4">
<h4 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_surf.html">plot_surf</a></span><span class="op">(</span>surf_data <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">thresholded_tstat_map</span>, filename <span class="op">=</span> <span class="st">'sigcluster.png'</span>, surface <span class="op">=</span> <span class="st">'inflated'</span>, cmap <span class="op">=</span> <span class="st">'seismic'</span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><code>surf_data</code>: A numeric vector (length of V) or a matrix (N rows x V columns), where N is the number of subplots, and V is the number of vertices. It can be the output from SURFvextract(), FSLRvextract(), CAT12vextract(), HIPvextract() as well as masks or vertex-wise results outputted by analyses functions.</p></li>
<li><p><code>filename</code>: A string object containing the desired name of the output .png. Default is ‘plot.png’ in the R temporary directory (tempdir()).Only filenames with a .png extension are allowed.</p></li>
<li>
<p><code>cmap</code> (optional) : A string object specifying the name of an existing colormap or a vector of hexadecimal color codes to be used as a custom colormap. The names of existing colormaps are listed in the .</p>
<p>Default cmap is set to <code>"Reds"</code> for positive values, <code>"Blues_r"</code> for negative values and <code>"RdBu"</code> when both positive and negative values exist.</p>
</li>
<li><p><code>title</code> (optional) : A string object for setting the title in the plot. Default is none. For titles that too long to be fully displayed within the plot, we recommend splitting them into multiple lines by inserting “\n”.</p></li>
<li><p><code>surface</code> (optional) : A string object containing the name of the type of cortical surface background rendered. Possible options include <code>"white"</code>, <code>"smoothwm"</code>,<code>"pial"</code> and <code>"inflated"</code> (default). The surface parameter is ignored for hippocampal surface data.</p></li>
</ul>
<div class="float">
<img src="reference/figures/sigcluster.png" alt="Significant clusters for the effect of age on thickness"><div class="figcaption">Significant clusters for the effect of age on thickness</div>
</div>
</div>
<div class="section level4">
<h4 id="extracting-the-ct-values-for-each-subject">Extracting the CT values for each subject<a class="anchor" aria-label="anchor" href="#extracting-the-ct-values-for-each-subject"></a>
</h4>
<p>If you want to carry out some follow-up analyses (e.g., mediation), you might want to extract, for each subject in the dataset, the mean CT in the significant clusters colored in red (positive clusters). You can simply do a matrix multiplication (operator for matrix multiplication :<code>%*%</code>) between the CT data <code>SPRENG_CTv</code> and the positive mask <code>results$pos_mask</code> . A mask in the context of brain images refers to a vector of 1s and 0s. In this case, the vertices which are within the significant clusters are coded as 1s, vertices outside these significant clusters are coded as 0s. <code>sum(results$pos_mask)</code> gives you the sum of all the 1s, which essentially is the number of significant vertices.</p>
<p>Thus, the <code>SPRENG_CTv %*% results$pos_mask</code> is divided by <code>sum(results$pos_mask)</code> to obtain an average CT value. Here, this average CT is saved into a new variable <code>sig_avCT</code> within the <code>demodata</code> dataframe.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demodata</span><span class="op">$</span><span class="va">sig_avCT</span><span class="op">=</span><span class="va">SPRENG_CTv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">results</span><span class="op">$</span><span class="va">pos_mask</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">pos_mask</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">demodata</span><span class="op">$</span><span class="va">sig_avCT</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">##         [,1]</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">##[1,] 2.769453</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">##[2,] 3.003829</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="do">##[3,] 2.586192</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="do">##[4,] 2.851196</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="do">##[5,] 3.199390</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="do">##[6,] 3.050331</span></span></code></pre></div>
<p>As a sanity check, these mean CT values should correlate with <code>age</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">demodata</span><span class="op">$</span><span class="va">sig_avCT</span>,<span class="va">demodata</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="do">##Pearson's product-moment correlation</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="do">##data:  demodata$sig_avCT and demodata$age</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="do">##t = 4.826, df = 236, p-value = 2.502e-06</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="do">##alternative hypothesis: true correlation is not equal to 0</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="do">##95 percent confidence interval:</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="do">## 0.1793792 0.4111954</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="do">##sample estimates:</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="do">##      cor </span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="do">##0.2997047 </span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level1">
<div class="page-header"><h1 id="image-decoding">Image decoding<a class="anchor" aria-label="anchor" href="#image-decoding"></a>
</h1></div>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>After running the whole-brain vertex-wise analyses, you may be able to identify regions in the brain in which cortical thickness (CT) values are significantly different between groups or these CT values predict a certain IV significantly. How do we make sense of these regions? We can plot out the results using the <code><a href="reference/plot_surf.html">plot_surf()</a></code> function, but still, it may be difficult to interpret the results in terms of the functional relevance of the regions identified. Here we present a tool that you can use to facilitate such interpretations.</p>
<p>What this tool does is correlate your input image (cortical surface maps obtained from an earlier vertex-wise analysis, currently supporting fsaverage5 surface space) with images from a large database of task-based fMRI and voxel-based morphometric studies. Each of these images in the database is tagged with a few keywords, describing the task and/or sample characteristics. The correlations that are carried out essentially measure how similar your input image is to each of the images in the database. Higher correlations would mean that your input image looks very similar to a certain image in the database, thus the keywords associated with that image in the database would be highly relevant to your input image.</p>
<p>In this example, we will first run a whole-brain vertex-wise analysis to compare the cortical thickness between males and females in the young adult population of the SPRENG dataset. The thresholded cortical surface maps obtained from this analysis will then be fed into an image-decoding procedure to identify keywords that are relevant to our results</p>
</div>
<div class="section level3">
<h3 id="source-custom-made-r-functions-from-github">Source custom-made R functions from Github<a class="anchor" aria-label="anchor" href="#source-custom-made-r-functions-from-github"></a>
</h3>
<p>The <a href="https://nimare.readthedocs.io/en/stable/index.html" class="external-link">NiMARE</a> python module is needed in order for the imaging decoding to work. It is similarly imported by VertexWiseR via reticulate in the decode_surf_data() function.</p>
</div>
<div class="section level3">
<h3 id="load-and-prepare-data">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#filter out old participants</span></span>
<span><span class="va">dat_beh</span><span class="op">=</span><span class="va">demodata</span><span class="op">[</span><span class="va">demodata</span><span class="op">$</span><span class="va">agegroup</span><span class="op">==</span><span class="st">"Y"</span>,<span class="op">]</span></span>
<span><span class="va">dat_CT</span><span class="op">=</span><span class="va">SPRENG_CTv</span><span class="op">[</span><span class="va">demodata</span><span class="op">$</span><span class="va">agegroup</span><span class="op">==</span><span class="st">"Y"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">all_pred</span><span class="op">=</span><span class="va">dat_beh</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site"</span>,<span class="st">"age"</span>,<span class="st">"sex"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_pred</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">##    site age sex</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="do">## 1     1  21   F</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="do">## 15    1  32   M</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="do">## 16    1  20   M</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="do">## 17    1  21   M</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="do">## 18    1  24   M</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="do">## 19    1  20   M</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vertex-wise-analysis">Vertex-wise analysis<a class="anchor" aria-label="anchor" href="#vertex-wise-analysis"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">=</span><span class="fu"><a href="reference/RFT_vertex_analysis.html">RFT_vertex_analysis</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">all_pred</span>, contrast <span class="op">=</span><span class="va">all_pred</span><span class="op">$</span><span class="va">sex</span>, surf_data <span class="op">=</span> <span class="va">dat_CT</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">cluster_level_results</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## The binary variable 'sex' will be recoded with F=0 and M=1 for the analysis</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">## smooth_FWHM argument was not given. surf_data will not be smoothed here.</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="do">## $`Positive contrast`</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="do">##   clusid nverts      P     X     Y     Z tstat              region</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="do">## 1      1    301 &lt;0.001 -40.7 -13.0  16.5  5.06      lh-postcentral</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="do">## 2      2    181  0.002  56.3  12.1 -10.1  4.43 rh-superiortemporal</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="do">## 3      3    150  0.003  21.9 -51.6  -1.2  4.41          rh-lingual</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="do">## $`Negative contrast`</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="do">## [1] "No significant clusters"</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_surf.html">plot_surf</a></span><span class="op">(</span>surf_data <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">thresholded_tstat_map</span>,filename <span class="op">=</span> <span class="st">"sexdiff.png"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="reference/figures/sexdiff.png" alt="Significant clusters for effect of sex on cortical thickness"><div class="figcaption">Significant clusters for effect of sex on cortical thickness</div>
</div>
<p>According to these results, since the female sex is coded as 0 and males as 1 (this can be done manually beforehand), the regions colored in red are thicker in males.</p>
</div>
<div class="section level3">
<h3 id="image-decoding-1">Image decoding<a class="anchor" aria-label="anchor" href="#image-decoding-1"></a>
</h3>
<p>Now, let’s enter the <code>thresholded_tstat_map</code> into the <code>decode_img()</code> function. The previous results only contained positive clusters. But in case of bidirectionality, the function requires to choose one direction with the contrast option. In this instance, we simply decode the positive clusters, by setting <code>contrast="positive"</code>.</p>
<p>If you are running this for the first time, a ~7.5 MB file <code>neurosynth_dataset.pkl.gz</code> needs to be downloaded to your current directory for the decoding to work. This file will contain the images from the <a href="https://neurosynth.org/" class="external-link">Neurosynth</a> database that will be correlated with your input image. Run VWRfirstrun(requirement=‘neurosynth’) to assist you with the data’s installation.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords</span><span class="op">=</span><span class="fu"><a href="reference/decode_surf_data.html">decode_surf_data</a></span><span class="op">(</span>surf_data<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">thresholded_tstat_map</span>, contrast <span class="op">=</span> <span class="st">"positive"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="do">##Converting and interpolating the surface data ... </span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="do">##✓ </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="do">## Correlating input image with images in the neurosynth database. This may take a while ... </span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="do">##✓    </span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">keywords</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="do">##      keyword     r</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="do">##449      pain 0.099</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="do">##50   auditory 0.098</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="do">##648  temporal 0.093</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="do">##617    speech 0.092</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="do">##334 listening 0.089</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="do">##607    sounds 0.070</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="do">##450   painful 0.068</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="do">##4    acoustic 0.062</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="do">##397     music 0.062</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="do">##398   musical 0.062</span></span></code></pre></div>
<p>The above procedure will display the top 10 keywords from images in the database that are the most correlated with your input image. According to these results, you can see that the positive clusters (which are thicker in males) are typically found to be associated with pain and auditory processing. If you simply run <code>keyword</code> without specifying the index within the square brackets <code>[1:10,]</code>. All 715 keywords will be displayed.</p>
<p>In your presentation slides or results section of your paper, you might want to illustrate these keywords using the <a href="https://www.rdocumentation.org/packages/wordcloud/versions/2.6" class="external-link">wordcloud</a> and <a href="https://CRAN.R-project.org/package=paletteer" class="external-link">paletteer</a> packages. You can set the size of the keyword to vary according to its r value:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("wordcloud","paletteer")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://blog.fellstat.com/?cat=11" class="external-link">wordcloud</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmilHvitfeldt/paletteer" class="external-link">paletteer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html" class="external-link">wordcloud</a></span><span class="op">(</span>words <span class="op">=</span> <span class="va">keywords</span><span class="op">$</span><span class="va">keyword</span>, <span class="co">##keyword input</span></span>
<span>          freq <span class="op">=</span> <span class="va">keywords</span><span class="op">$</span><span class="va">r</span>, <span class="co">##setting the size of the keyword to vary with its r value</span></span>
<span>          min.freq <span class="op">=</span> <span class="fl">0.05</span>, <span class="co">##minimum r value in order for the keyword to be displayed</span></span>
<span>          colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/paletteer/man/paletteer_c.html" class="external-link">paletteer_c</a></span><span class="op">(</span><span class="st">"grDevices::Temps"</span>, <span class="fl">10</span><span class="op">)</span> <span class="co">##color scheme</span></span>
<span>          ,scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span> </span>
<span>          <span class="op">)</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/wordcloud.jpg" alt="Wordcloud plot of keywords associated with the clusters"><!-- --></p>
<p>These keywords may not be very accurate but they should give a rough idea for interpreting your results. Take note that these keywords are specific to the positive clusters.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=VertexWiseR" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing VertexWiseR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Junhong Yu <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-2563-9658" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Charly Billaud <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0009-0001-3466-9963" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Junhong Yu, Charly Billaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
